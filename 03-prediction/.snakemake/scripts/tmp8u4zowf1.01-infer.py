######## snakemake preamble start (automatically inserted, do not edit) ########
import sys;sys.path.extend(['/home/hblee/.conda/envs/jax_main/lib/python3.12/site-packages', '/home/hblee/tslmm_paper/08-infer', '/home/hblee/.conda/envs/jax_main/lib/python3.12', '/home/hblee/.conda/envs/jax_main/lib/python3.12/lib-dynload', '/home/hblee/.conda/envs/jax_main/lib/python3.12/site-packages', '/home/hblee/.cache/snakemake/snakemake/source-cache/runtime-cache/tmp9cfis2_c/file/home/hblee/tslmm_paper/08-infer', '/home/hblee/tslmm_paper/08-infer']);import pickle;from snakemake import script;script.snakemake = pickle.loads(b'\x80\x04\x95\xe0\x04\x00\x00\x00\x00\x00\x00\x8c\x10snakemake.script\x94\x8c\tSnakemake\x94\x93\x94)\x81\x94}\x94(\x8c\x05input\x94\x8c\x0csnakemake.io\x94\x8c\nInputFiles\x94\x93\x94)\x81\x94\x8c\x1btree_sequences/ts_n50000.ts\x94a}\x94(\x8c\x06_names\x94}\x94\x8c\x07ts_path\x94K\x00N\x86\x94s\x8c\x12_allowed_overrides\x94]\x94(\x8c\x05index\x94\x8c\x04sort\x94eh\x12h\x06\x8c\x0eAttributeGuard\x94\x93\x94)\x81\x94}\x94\x8c\x04name\x94h\x12sbh\x13h\x15)\x81\x94}\x94h\x18h\x13sbh\x0eh\nub\x8c\x06output\x94h\x06\x8c\x0bOutputFiles\x94\x93\x94)\x81\x94\x8c$inferred_tree_sequences/ts_n50000.ts\x94a}\x94(h\x0c}\x94\x8c\x0cts_save_path\x94K\x00N\x86\x94sh\x10]\x94(h\x12h\x13eh\x12h\x15)\x81\x94}\x94h\x18h\x12sbh\x13h\x15)\x81\x94}\x94h\x18h\x13sbh"h\x1fub\x8c\r_params_store\x94h\x06\x8c\x06Params\x94\x93\x94)\x81\x94}\x94(h\x0c}\x94h\x10]\x94(h\x12h\x13eh\x12h\x15)\x81\x94}\x94h\x18h\x12sbh\x13h\x15)\x81\x94}\x94h\x18h\x13sbub\x8c\r_params_types\x94}\x94\x8c\twildcards\x94h\x06\x8c\tWildcards\x94\x93\x94)\x81\x94\x8c\x0550000\x94a}\x94(h\x0c}\x94\x8c\x0fnum_individuals\x94K\x00N\x86\x94sh\x10]\x94(h\x12h\x13eh\x12h\x15)\x81\x94}\x94h\x18h\x12sbh\x13h\x15)\x81\x94}\x94h\x18h\x13sb\x8c\x0fnum_individuals\x94h:ub\x8c\x07threads\x94K\x01\x8c\tresources\x94h\x06\x8c\tResources\x94\x93\x94)\x81\x94(K\x01K\x01J\xa0\x86\x01\x00M\xba\x03M\xe8\x03M\xba\x03\x8c\x04/tmp\x94\x8c\x08standard\x94\x8c\x06jonth0\x94K\x01\x8c\x04100g\x94K\x04\x8c\x0b02-00:00:01\x94e}\x94(h\x0c}\x94(\x8c\x06_cores\x94K\x00N\x86\x94\x8c\x06_nodes\x94K\x01N\x86\x94\x8c\x06mem_mb\x94K\x02N\x86\x94\x8c\x07mem_mib\x94K\x03N\x86\x94\x8c\x07disk_mb\x94K\x04N\x86\x94\x8c\x08disk_mib\x94K\x05N\x86\x94\x8c\x06tmpdir\x94K\x06N\x86\x94\x8c\tpartition\x94K\x07N\x86\x94\x8c\x07account\x94K\x08N\x86\x94\x8c\x05nodes\x94K\tN\x86\x94\x8c\x03mem\x94K\nN\x86\x94\x8c\x0bnum_threads\x94K\x0bN\x86\x94\x8c\ntime_limit\x94K\x0cN\x86\x94uh\x10]\x94(h\x12h\x13eh\x12h\x15)\x81\x94}\x94h\x18h\x12sbh\x13h\x15)\x81\x94}\x94h\x18h\x13sbhQK\x01hSK\x01hUJ\xa0\x86\x01\x00hWM\xba\x03hYM\xe8\x03h[M\xba\x03h]hJ\x8c\tpartition\x94hK\x8c\x07account\x94hL\x8c\x05nodes\x94K\x01\x8c\x03mem\x94hM\x8c\x0bnum_threads\x94K\x04\x8c\ntime_limit\x94hNub\x8c\x03log\x94h\x06\x8c\x03Log\x94\x93\x94)\x81\x94}\x94(h\x0c}\x94h\x10]\x94(h\x12h\x13eh\x12h\x15)\x81\x94}\x94h\x18h\x12sbh\x13h\x15)\x81\x94}\x94h\x18h\x13sbub\x8c\x06config\x94}\x94\x8c\x04rule\x94\x8c\x03its\x94\x8c\x0fbench_iteration\x94N\x8c\tscriptdir\x94\x8c /home/hblee/tslmm_paper/08-infer\x94ub.');del script;from snakemake.logging import logger;from snakemake.script import snakemake; logger.printshellcmds = True;__real_file__ = __file__; __file__ = '/home/hblee/tslmm_paper/08-infer/01-infer.py';
######## snakemake preamble end #########
import numpy as np

import tskit
import msprime
import tsinfer
import tsdate

from snakemake.script import snakemake

# load data
ts = tskit.load(snakemake.input.ts_path)

# infer tree sequence
sample_data = tsinfer.SampleData.from_tree_sequence(ts)
inferred_ts = tsinfer.infer(sample_data)
simplified_ts = tsdate.preprocess_ts(inferred_ts)
dated_ts = tsdate.variational_gamma(simplified_ts, mutation_rate=1e-8, rescaling_intervals=10)

# save data
dated_ts.dump(snakemake.output.ts_save_path)